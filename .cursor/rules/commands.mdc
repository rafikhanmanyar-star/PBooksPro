---
description: Build and deploy commands for staging and production
alwaysApply: true
---

# PBooks Pro – Commands

## Deploy to Staging

```powershell
npm run deploy:staging
# or: .\deploy-staging.ps1
```

**What it does (in order):**
1. Increments patch version (e.g. 1.2.2 → 1.2.3)
2. Builds electron staging installer → `release-staging/`
3. Copies `latest.yml` to `server/updates/` and `website/Website/updates/` (for auto-update)
4. Registers release in `server/releases/releases.json` and uploads to GitHub Releases (if `gh` CLI available)
5. Stages and commits all changes
6. Pushes to remote `staging` branch ONLY → triggers Render staging auto-deploy

**Render staging services redeployed:**
- `pbookspro-api-staging` (API server)
- `pbookspro-admin-staging` (Admin portal)
- `pbookspro-website-staging` (Website)

---

## Deploy to Production

```powershell
npm run deploy:production
# or: .\deploy-production.ps1
```

**What it does (in order):**
1. Prompts for confirmation before proceeding
2. Builds electron production installer → `release/`
3. Copies `latest.yml` to `server/updates/` and `website/Website/updates/` (for auto-update)
4. Registers release in `server/releases/releases.json` and uploads to GitHub Releases (if `gh` CLI available)
5. Stages and commits all changes
6. Pushes to remote `staging` branch (keeps staging in sync)
7. Merges into `main` and pushes → triggers Render production auto-deploy

**Render production services redeployed:**
- `pbookspro-api` (API server)
- `pbookspro-admin` (Admin portal)
- `pbookspro-website` (Website)

---

## Other Useful Commands

| Command | Description |
|---------|-------------|
| `npm run dev` | Start Vite dev server |
| `npm run build` | Build frontend only |
| `npm run electron:dev` | Run electron app in dev mode |
| `npm run electron:staging` | Run staging electron app locally |
| `npm run electron:staging:installer` | Build staging installer only (no deploy) |
| `npm run electron:production:installer` | Build production installer only (no deploy) |

## Branch → Render Mapping

| Branch | Render Services | Environment |
|--------|----------------|-------------|
| `staging` | api-staging, admin-staging, website-staging | Staging |
| `main` | api, admin, website | Production |


How It Works
API server runs locally at http://localhost:3000 using tsx --watch (hot-reload on server file changes) and connects to the staging PostgreSQL database via the DATABASE_URL in server/.env
Electron app is built with Vite (no VITE_API_URL set, so it defaults to http://localhost:3000/api) and launched directly — no installer, no electron-builder, no git push
server/.env is already in .gitignore so your credentials won't be committed
Typical workflow
Make your code changes
Run npm run test:local
Test in the Electron app
If you only changed server code, the tsx --watch will auto-reload — no restart needed
If you changed frontend code, stop and re-run npm run test:local (or run npm run test:server in one terminal and npm run test:electron in another so you only rebuild the frontend)
