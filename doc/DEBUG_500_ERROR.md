# Debug 500 Error on Admin Login

The admin portal is now using the correct URL, but getting a 500 error. Let's debug this.

## Step 1: Check API Server Logs

1. **Go to Render Dashboard** → **pbookspro-api** service
2. **Go to "Logs" tab**
3. **Look for error messages** when you try to login
4. **Should see:** `Admin login error:` followed by the actual error

Common errors:
- `relation "admin_users" does not exist` → Table not created
- `JWT_SECRET is not defined` → Missing environment variable
- `Database connection error` → Database connection issue
- `password is null` → Admin user doesn't have password set

## Step 2: Verify Admin User Exists

Run this SQL in DBeaver:

```sql
SELECT id, username, email, role, is_active, 
       CASE WHEN password IS NULL THEN 'NULL' ELSE 'SET' END as password_status
FROM admin_users 
WHERE username = 'Admin';
```

**Should return:**
- One row with username = 'Admin'
- is_active = TRUE
- password_status = 'SET' (not NULL)

## Step 3: Verify Environment Variables

Check in Render Dashboard → **pbookspro-api** → **Environment**:

1. **JWT_SECRET** - Should be set (auto-generated by Render)
2. **DATABASE_URL** - Should be set (linked from database)
3. **NODE_ENV** - Should be `production`

## Step 4: Use Create-Admin Endpoint

If admin user doesn't exist or password is wrong, use the endpoint:

```bash
curl -X POST https://pbookspro-api.onrender.com/api/admin/create-admin
```

This will create/update the admin user with the correct password.

## Step 5: Check Database Connection

The error might be a database connection issue. Check:

1. **Render Dashboard** → **pbookspro-api** → **Logs**
2. **Look for:** `✅ Connected to PostgreSQL database`
3. **If you see connection errors**, the database might be down

## Most Likely Causes

1. **Admin user doesn't exist** → Use create-admin endpoint
2. **JWT_SECRET not set** → Check environment variables
3. **Database connection issue** → Check database status
4. **Table doesn't exist** → Run migration

---

**First, check the API server logs to see the actual error message!**

