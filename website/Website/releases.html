<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Download the latest version of PBooksPro desktop application. View all releases and changelogs.">
    <title>Releases - PBooksPro</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .releases-section { padding: 3rem 0 4rem; }

        .releases-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }
        .releases-header h2 { margin: 0; }

        .env-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            padding: 0.35rem 1rem;
            border-radius: 2rem;
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .env-badge.production { background: #dcfce7; color: #166534; }
        .env-badge.staging    { background: #fef3c7; color: #92400e; }

        .releases-loading,
        .releases-empty,
        .releases-error {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-light);
        }
        .releases-loading i { font-size: 2rem; margin-bottom: 1rem; display: block; }
        .releases-empty i   { font-size: 3rem; margin-bottom: 1rem; display: block; opacity: 0.5; }
        .releases-error     { color: var(--danger-color); }
        .releases-error i   { font-size: 3rem; margin-bottom: 1rem; display: block; }

        .release-card {
            background: var(--bg-white);
            border: 1px solid var(--border-color);
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow);
            transition: box-shadow 0.3s;
        }
        .release-card:hover { box-shadow: var(--shadow-lg); }
        .release-card.latest {
            border-color: var(--primary-color);
            border-width: 2px;
            position: relative;
        }
        .latest-tag {
            position: absolute;
            top: -12px;
            left: 24px;
            background: var(--primary-color);
            color: white;
            padding: 0.2rem 0.8rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .release-top {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
            flex-wrap: wrap;
            gap: 0.75rem;
        }
        .release-version {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-dark);
        }
        .release-date {
            color: var(--text-light);
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        .release-changelog {
            color: var(--text-light);
            margin-bottom: 1.25rem;
            line-height: 1.7;
        }
        .release-changelog:empty { display: none; }

        .release-files {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
        }
        .download-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.6rem 1.4rem;
            border-radius: 0.5rem;
            text-decoration: none;
            font-weight: 500;
            font-size: 0.9rem;
            transition: all 0.3s;
            border: none;
            cursor: pointer;
        }
        .download-btn.primary {
            background: var(--primary-color);
            color: white;
        }
        .download-btn.primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        .download-btn.secondary {
            background: var(--bg-light);
            color: var(--text-dark);
            border: 1px solid var(--border-color);
        }
        .download-btn.secondary:hover {
            background: var(--border-color);
            transform: translateY(-2px);
        }
        .file-size {
            font-size: 0.8rem;
            color: var(--text-light);
            margin-left: 0.25rem;
        }

        .auto-update-info {
            background: var(--bg-light);
            border-radius: 1rem;
            padding: 2rem;
            margin-top: 2rem;
        }
        .auto-update-info h3 {
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .auto-update-info p { color: var(--text-light); margin-bottom: 0.5rem; }
        .auto-update-info p:last-child { margin-bottom: 0; }

        @media (max-width: 768px) {
            .release-top { flex-direction: column; }
            .release-files { flex-direction: column; }
            .download-btn { justify-content: center; }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <div class="nav-wrapper">
                <div class="logo">
                    <i class="fas fa-building"></i>
                    <span>PBooksPro</span>
                </div>
                <ul class="nav-menu" id="navMenu">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="features.html">Features</a></li>
                    <li><a href="pricing.html">Pricing</a></li>
                    <li><a href="about.html">About</a></li>
                    <li><a href="blog.html">Blog</a></li>
                    <li><a href="help.html">Help</a></li>
                    <li><a href="contact.html">Contact</a></li>
                    <li><a href="releases.html" class="active">Releases</a></li>
                    <li><a href="download.html" class="btn-primary">Free Trial</a></li>
                </ul>
                <div class="hamburger" id="hamburger">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
        </div>
    </nav>

    <!-- Page Header -->
    <section class="page-header">
        <div class="container">
            <h1>Desktop App Releases</h1>
            <p>Download the latest version of the PBooksPro desktop application or browse previous releases.</p>
        </div>
    </section>

    <!-- Releases List -->
    <section class="releases-section">
        <div class="container">
            <div class="releases-header">
                <h2>All Releases</h2>
                <span class="env-badge" id="envBadge"></span>
            </div>

            <div id="releasesContainer">
                <div class="releases-loading">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>Loading releases...</p>
                </div>
            </div>

            <div class="auto-update-info">
                <h3><i class="fas fa-sync-alt"></i> Automatic Updates</h3>
                <p>If you already have PBooksPro installed, the application will automatically check for updates and notify you when a new version is available.</p>
                <p>You can also manually check for updates from within the app via <strong>Help &rarr; Check for Updates</strong>.</p>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-col">
                    <div class="footer-logo">
                        <i class="fas fa-building"></i>
                        <span>PBooksPro</span>
                    </div>
                    <p>All-in-One Financial Management for Real Estate Professionals</p>
                </div>
                <div class="footer-col">
                    <h4>Product</h4>
                    <ul>
                        <li><a href="features.html">Features</a></li>
                        <li><a href="releases.html">Releases</a></li>
                        <li><a href="download.html">Free Trial</a></li>
                        <li><a href="pricing.html">Pricing</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Company</h4>
                    <ul>
                        <li><a href="about.html">About Us</a></li>
                        <li><a href="blog.html">Blog</a></li>
                        <li><a href="contact.html">Contact</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Support</h4>
                    <ul>
                        <li><a href="help.html">Help & Guide</a></li>
                        <li><a href="help.html">User Documentation</a></li>
                        <li><a href="contact.html">Contact Support</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 PBooksPro. All rights reserved.</p>
                <div class="footer-links">
                    <a href="privacy-policy.html">Privacy Policy</a>
                    <a href="terms-of-service.html">Terms of Service</a>
                    <a href="refund-policy.html">Refund Policy</a>
                </div>
            </div>
        </div>
    </footer>

    <script src="script.js"></script>
    <script>
    (function() {
        var API_URLS = {
            'www.pbookspro.com':                        'https://api.pbookspro.com/api/app-info',
            'pbookspro-website.onrender.com':           'https://api.pbookspro.com/api/app-info',
            'pbookspro-website-staging.onrender.com':   'https://pbookspro-api-staging.onrender.com/api/app-info',
        };
        var host = window.location.hostname;
        var baseUrl = API_URLS[host] || 'https://pbookspro-api-staging.onrender.com/api/app-info';

        var isStaging = host.includes('staging') || host === 'localhost' || host === '127.0.0.1';
        var envLabel = isStaging ? 'staging' : 'production';

        var badge = document.getElementById('envBadge');
        badge.textContent = envLabel === 'staging' ? 'Staging Builds' : 'Production Builds';
        badge.classList.add(envLabel);

        var container = document.getElementById('releasesContainer');

        fetch(baseUrl + '/releases')
            .then(function(r) { return r.json(); })
            .then(function(data) {
                if (!data.releases || data.releases.length === 0) {
                    container.innerHTML =
                        '<div class="releases-empty">' +
                            '<i class="fas fa-box-open"></i>' +
                            '<h3>No Releases Yet</h3>' +
                            '<p>There are no ' + envLabel + ' releases available at this time. Check back soon!</p>' +
                        '</div>';
                    return;
                }
                container.innerHTML = '';
                data.releases.forEach(function(release, idx) {
                    container.appendChild(buildReleaseCard(release, idx === 0));
                });
            })
            .catch(function(err) {
                console.error('Failed to load releases:', err);
                container.innerHTML =
                    '<div class="releases-error">' +
                        '<i class="fas fa-exclamation-triangle"></i>' +
                        '<h3>Unable to Load Releases</h3>' +
                        '<p>Could not connect to the server. Please try again later.</p>' +
                    '</div>';
            });

        function buildReleaseCard(release, isLatest) {
            var card = document.createElement('div');
            card.className = 'release-card' + (isLatest ? ' latest' : '');

            var html = '';
            if (isLatest) {
                html += '<span class="latest-tag">Latest</span>';
            }

            html += '<div class="release-top">';
            html += '  <span class="release-version">v' + escHtml(release.version) + '</span>';
            html += '  <span class="release-date"><i class="far fa-calendar-alt"></i> ' + formatDate(release.date) + '</span>';
            html += '</div>';

            if (release.changelog) {
                html += '<div class="release-changelog">' + escHtml(release.changelog) + '</div>';
            }

            html += '<div class="release-files">';
            if (release.files && release.files.length > 0) {
                release.files.forEach(function(file) {
                    var isPrimary = file.type === 'installer';
                    var icon = isPrimary ? 'fa-download' : 'fa-file';
                    var label = isPrimary ? 'Download Installer' : 'Portable Version';
                    html += '<a href="' + escAttr(file.downloadUrl) + '" class="download-btn ' + (isPrimary ? 'primary' : 'secondary') + '">';
                    html += '  <i class="fas ' + icon + '"></i> ' + escHtml(label);
                    if (file.size) {
                        html += ' <span class="file-size">(' + formatSize(file.size) + ')</span>';
                    }
                    html += '</a>';
                });
            } else {
                html += '<span style="color:var(--text-light);font-size:0.9rem;">Download not available</span>';
            }
            html += '</div>';

            card.innerHTML = html;
            return card;
        }

        function formatDate(iso) {
            try {
                var d = new Date(iso);
                return d.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
            } catch (e) { return iso; }
        }

        function formatSize(bytes) {
            if (bytes >= 1073741824) return (bytes / 1073741824).toFixed(1) + ' GB';
            if (bytes >= 1048576)    return (bytes / 1048576).toFixed(1) + ' MB';
            if (bytes >= 1024)       return (bytes / 1024).toFixed(1) + ' KB';
            return bytes + ' B';
        }

        function escHtml(s) {
            var d = document.createElement('div');
            d.appendChild(document.createTextNode(s));
            return d.innerHTML;
        }

        function escAttr(s) {
            return s.replace(/&/g,'&amp;').replace(/"/g,'&quot;').replace(/'/g,'&#39;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
        }
    })();
    </script>
</body>
</html>
